
<!DOCTYPE HTML>
<html>

<head>
  <title>MY Web</title>
  <link href="stylesheets/bootstrap.min.css" rel='stylesheet' type='text/css' />
  <link href="stylesheets/style.css" rel='stylesheet' type='text/css' />
  <link href="stylesheets/compiled-4.7.1.min.css" rel='stylesheet' type='text/css' />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="keywords" content="Personal Blog Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template, 
	Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
  <script type="application/x-javascript">
    addEventListener("load", function () {
      setTimeout(hideURLbar, 0);
    }, false);

    function hideURLbar() {
      window.scrollTo(0, 1);
    }
  </script>
  <!----webfonts---->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
    crossorigin="anonymous">

 
  <link href="https://unpkg.com/gijgo@1.9.11/css/gijgo.min.css" rel="stylesheet" type="text/css" />
 

</head>

<body class="light-blue-skin">

  <!--Double navigation-->
  <header>

    <!-- Navbar -->
    <nav class="navbar fixed-top navbar-toggleable-md navbar-expand-lg scrolling-navbar double-nav">
      <!-- SideNav slide-out button -->

      <!-- Breadcrumb-->
      <div class="breadcrumb-dn mr-auto">
        <p>Welcome to your Dashborad</p>
      </div>
      <ul class="nav navbar-nav nav-flex-icons ml-auto">
        <!-- <li class="nav-item">
          <a class="nav-link"><i class="fas fa-envelope"></i> <span class="clearfix d-none d-sm-inline-block">Contact</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link"><i class="far fa-comments"></i> <span class="clearfix d-none d-sm-inline-block">Support</span></a>
        </li> -->

        <li class="nav-item">
          <a href="/users/dashboard" class="nav-link"><i class="fas fa-book"></i> <span class="clearfix d-none d-sm-inline-block">Article</span></a>
        </li>
        <li class="nav-item">
          <a href="/profile" class="nav-link"><i class="fas fa-user"></i> <span class="clearfix d-none d-sm-inline-block">Profile</span></a>
        </li>
        <li class="nav-item">
          <a href="/users" class="nav-link"><i class="fas fa-home"></i> <span class="clearfix d-none d-sm-inline-block">Home</span></a>
        </li>

      </ul>
    </nav>
    <!-- /.Navbar -->
  </header>
  <!--/.Double navigation-->

  <!--Main Layout-->
  <main>
    <div class="container mt-6" style="color: whitesmoke">
      <h2>Advanced Double Navigation with fixed SideNav & fixed Navbar:</h2>
      <br>
      <h5>1. Fixed side menu, hidden on small devices.</h5>
      <h5>2. Fixed Navbar. It will always stay visible on the top, even when you scroll down.</h5>


      <div class="wrapper-modal-editor">

        <div class="block my-4">
          <div class="d-flex justify-content-center">
            <p class="h5 text-primary createShowP">0 row selected</p>
          </div>
        </div>

        <div class="row d-flex justify-content-center modalWrapper">


          <div class="text-center">
            <a href="/articles/addarticle" class="btn btn-info btn-rounded btn-md">Add<i class="fas fa-plus-square ml-1"></i></a>
          </div>



        </div>

        <table id="dtBasicExample" class="table table-striped table-bordered text-center mx-auto" cellspacing="0" style="width: 70%;">
          <thead>
            <tr>
              <th class="">

              </th>
              <th class="">Image

              </th>
              <th class="">Title

              </th>
              <th class="">Date

              </th>
              <th class="">options

              </th>

            </tr>
          </thead>
          <tbody>
            <% for(var i=0;i < art.length;i++){  %>
            <tr id='_<%= i+1 %>'>
              <!-- onclick="SelectedRow(<%= i+1 %>)" -->
              <!-- <input id='input<%= i+1 %>' type="hidden" value="<%= art[i].id %>" /> -->
              <td>
                <%= i+1 %>
              </td>
              <td><img id="image<%= i+1 %>" src="imageUploads/<%= art[i].image %>" style="width:200px; height:100px;" /></td>
              <td>
                <%= art[i].title %>
              </td>
              <td>
                <%= art[i].date %>
              </td>
              <input name="hiddenText" value="<%=art[i].text %>" type="hidden" />
              <!-- ma in input ro baray inke betonim da modal ke baraye edit article user hast estefade konim ke matn negaresh shode tavasot user dar inja rikhte mish 
              va baad ba jquery be modal edit pasash midahaim  -->
              <input name="hiddenId" value="<%=art[i]._id %>" type="hidden" />
              <td> <button onclick="deleteRow('<%= i+1 %>','<%= art[i]._id %>')" class="btn btn-danger btn-sm btn-rounded buttonDelete">Delete<i
                    class="fas fa-trash ml-1"></i></button>
                <button onclick="editRow('<%= i+1 %>','<%= art[i].id %>')" class="btn btn-info btn-rounded btn-sm buttonEdit"
                  data-toggle="modal" data-target="#modalEdit">Edit<i class="fas fa-edit ml-1"></i></button>
              </td>
            </tr>
            <% }%>











            <div class="modal fade" id="modalEdit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
              aria-hidden="true">
              <form id="editForm" method="post" action="/articles/editarticle" enctype="multipart/form-data">
                  
                <div id="edi" class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header text-center">
                      <h4 class="modal-title w-100 font-weight-bold text-dark">Edit Post</h4>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>

                    <div class="modal-body mx-3">
                      <input id="idOfRow" name="mid" value="" type="hidden" />
                      <!-- baray inke befahmim kodom satr ro bayad edit konim  -->
                      <input id="perimage" name="perimg" value="" type="hidden" />
                      <!-- baray in  input ro gozashtim ke agar karbar aksesho avaz nakard betoonim aks qablisho behesh bedim -->

                      <div class="file-field">
                        <div class="mb-4  text-center">
                          <img id="imgPreviewProduct" src="" style="width: 200px; " class=" z-depth-1-half avatar-pic"
                            alt="example placeholder avatar">
                        </div>
                        <div class="d-flex justify-content-center mb-2">
                          <div id="button" class="btn  btn-rounded float-left z-depth-1a btn-sm">
                            <span>change image</span>
                            <input name="image" id="imageProduct" type="file">
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-6">
                          <div class="md-form mb-5">
                            <i class="fas fa-clipboard  prefix grey-text"></i>
                            <input name="title" type="text" id="form3" class="form-control validate" />
                            <label for="form3" style="transform: translateY(-140%);">Title</label>
                          </div>

                          <!-- <input name="kir" type="text" value="kir" class="form-control validate" /> -->
                          <div id="gag" class="md-form mb-4">
                            <i class="fas fa-clock prefix grey-text"></i>
                            <input name="tarikh" type="text" class="form-control validate" />
                            <!-- style="width: calc(100% - 2.5rem);
                    float: right; "> -->

                            <label style="transform: translateY(-140%); font-size: 0.8rem">Date</label>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class=" mb-0">
                            <label for="Text">Text</label>
                            <textarea name="Text" type="text" class="form-control " ></textarea>


                          </div>
                        </div>
                      </div>
                      <div class="modal-footer d-flex justify-content-center">
                        <button type="submit" class="btn btn-indigo">Send <i class="fas fa-paper-plane-o ml-1"></i></button>
                      </div>

                    </div>


                  </div>
                </div>
              </form>
            </div>




































          </tbody>

        </table>
      </div>
      <div style="height: 2000px"></div>
    </div>
  </main>
  <!--Main Layout-->
  <script src="javascripts/jquery-3.3.1.min.js" type="text/javascript"></script>
  <script src="javascripts/popper.min.js" type="text/javascript"></script>
  <script src="javascripts/bootstrap.min.js" type="text/javascript"></script>
  <script src="javascripts/mdb.min.js" type="text/javascript"></script>
 
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
  <!--/script-->
  <script src="https://unpkg.com/gijgo@1.9.11/js/gijgo.min.js" type="text/javascript"></script>

  <script src="CKEditor_HTML/CKEditor_HTML/ckeditor/ckeditor.js"></script>
  <script src="CKEditor_HTML/CKEditor_HTML/ckeditor/adapters/jquery.js"></script>




  <script type="text/javascript">
    jQuery(document).ready(function ($) {
      $('#datepicker').datepicker({
        format: 'yyyy/mm/dd',
        uiLibrary: 'bootstrap4'
      });
      $('#datapicker').siblings("span").css("display", "none");
    })


    function readURL(input) {

      if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
          $('#imgPreviewProduct').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
      }
    }

    $("#imageProduct").change(function () {
      readURL(this);
    });
    // $('#dtBasicExample').mdbEditor();
    // $('.dataTables_length').addClass('bs-select');
    // // SideNav Button Initialization
    // $(".button-collapse").sideNav();
    // SideNav Scrollbar Initialization
    // var sideNavScrollbar = document.querySelector('.custom-scrollbar');
    // Ps.initialize(sideNavScrollbar);

    jQuery(document).ready(function ($) {
      $(".scroll").click(function (event) {
        event.preventDefault();
        $('html,body').animate({
          scrollTop: $(this.hash).offset().top
        }, 900);
      });
    });


    CKEDITOR.replace('Text', {
      language: 'en'
    });
    $(function () {
      $('#Text').ckeditor();


    });
    $('#editForm').submit(function() {
        
        $(this).ajaxSubmit({

            error: function(xhr) {
       
        console.log("bega")
            },

            success: function(res) {
              $("#dtBasicExample").html($(res).find("#dtBasicExample").html());
                console.log(res);
                
            }
            
    });
    console.log("biron")
        //Very important line, it disable the page refresh.
    return false;
    });  

    //  $("#editForm").submit(function (e) {

    //   var x = CKEDITOR.instances['Text'].getData();
    //   var formData = new FormData(this);
    //   var form = $(this);
    //   console.log("qq"+form.serialize());
    //   var action = form.attr("action");
    //   var url = "http://localhost:3000" + action;
    //   $.ajax({
    //     type: "post",
    //     url: url,
    //     data:formData + "&re=" + x

    //   }).done(function (res) {
    //     $("#modalEdit").modal('hide');


    //     $("#dtBasicExample").html($(res).find("#dtBasicExample").html());
      
    //     console.log("Are");

    //   }).fail(function (xhr) {
    //     console.log("na");
    //   });

    //   console.log("biron");
    //   e.preventDefault();
    // });
//editRow:miayam input haye modal ro por mikonim ke ba form madal ersal shan 
    function editRow(rowId, articleId) {//rowId=id table toye safehe dash ,articleId =id table db ast 
    //ba zadan dokme edit in khat ejra mish ta befahme kodom bayad avaz she
 
      console.log($("#_" + rowId).children().eq(3).html());
      console.log($("#_" + rowId).children().eq(4).val());
      // console.log($("textarea[name=Text]").attr('name'));
      $("input[name=title]").val($("#_" + rowId).children().eq(2).html().trim());
      $("input[name=tarikh]").val($("#_" + rowId).children().eq(3).html().trim());
      // $(".cke_editable").append("<p>"+$("#_"+rowId).children().eq(4).val()+"</p>");
      $("#idOfRow").val($("#_" + rowId).children().eq(5).val());//
      // idOfRow name input type hiddenii dar modal ast ke miayam id table db ra be an midahim chera?
      // chon in safhe be samte backend post mishavad va hadaf ma in ast ke magadir in satr ra edit konim
      // bayad megdar id in satr ra bedanim




  //     var src = ($("#_" + rowId).children().eq(1).attr("src"));
  //     var src2 = $("#_" + rowId).children().eq(1).html();
  //   
  // $("#_" + rowId).children().eq(6).val()
      //  console.log(src2.substring(10,63));
      var esmeimage=$("#image" + rowId).attr("src");
      $("#perimage").val(esmeimage.substring(13,esmeimage.length));
      $("#imgPreviewProduct").attr('src', $("#image" + rowId).attr("src"));
      // $(".cke_editable")
      // $(".cke_editable").css("cssText","background-color:red !important")

      // console.log($("#cke_1_contents").attr('class'));
      // console.log($("#cke_1_contents").children().eq(1).html());
      CKEDITOR.instances['Text'].setData($("#_" + rowId).children().eq(4).val()); ///get data
 
      //   $.ajax({
      //    type:"post",
      //    url:"http://localhost:3000/articles/editarticle",
      //    data:{"myid":articleId},
      //   }).done(function(res){
      //     console.log("Are");
      //   }).fail(function(xhr){

      //   });
    }

    function deleteRow(rowId, articleId) {


      const swalWithBootstrapButtons = Swal.mixin({
        confirmButtonClass: 'btn btn-success',
        cancelButtonClass: 'btn btn-danger',
        buttonsStyling: false,
      })

      swalWithBootstrapButtons.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        type: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'No, cancel!',
        reverseButtons: true
      }).then((result) => {
        if (result.value) {
          swalWithBootstrapButtons.fire(
            'Deleted!',
            'Your file has been deleted.',
            'success'
          )
          console.log("&&&&&&&&&&&&&&&&&&&&&" + parseInt(rowId) + " " + rowId);
          $.ajax({
            type: "post",
            url: "http://localhost:3000/articles/delete",
            data: {
              "myid": articleId
            },
            contentType: "application/x-www-form-urlencoded; charset=UTF-8"//ba che formati az view be back befreestim 
            //dataType: peygam bazgashti az backend be ajax ra ba ch formati befrestam
          }).done(function (res) {
           
            $("#_" + rowId).hide('slow');
            
            $("#dtBasicExample").html($(res).find("#dtBasicExample").html());



          }).fail(function (xhr) {

            console.log("na");


          });
        } else if (
          // Read more about handling dismissals
          result.dismiss === Swal.DismissReason.cancel
        ) {
          swalWithBootstrapButtons.fire(
            'Cancelled',
            'Your imaginary file is safe :)',
            'error'
          )
        }
      })


    }
  </script>
</body>